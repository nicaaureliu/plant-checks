<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plant Checks</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 14px; background:#fff; color:#111; }
    .small { font-size: 12px; color: #666; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 12px; margin-bottom: 12px; background:#fff; }

    .buildTag { font-size:12px; color:#666; margin-bottom:8px; }

    /* Sheet-like header */
    .sheetHeader {
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:10px;
    }
    .logoLeft { width: 150px; height:auto; justify-self:start; object-fit:contain; }
    .logoRight { width: 55px; height:auto; justify-self:end; object-fit:contain; }
    .ref { font-size: 18px; justify-self:center; font-weight:700; }

    .sheetTitle { text-align:center; font-size: 16px; font-weight:700; margin: 10px 0 0; }

    .metaRow {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
      font-size: 12px;
    }
    .metaRow b { font-weight:700; }

    .yellowBar {
      margin-top:10px;
      background:#ffd600;
      padding:8px 10px;
      font-weight:700;
      font-size: 12px;
      text-align:center;
      border-top:1px solid #111;
      border-bottom:1px solid #111;
    }

    /* Inputs */
    label { font-size: 12px; color: #444; display:block; margin-bottom:6px; }
    input, textarea, button { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid #ccc; box-sizing: border-box; }
    textarea { min-height: 70px; }

    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .topBtns { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }

    .pill { background:#f3f3f3; border:1px solid #ddd; color:#111; font-weight:800; cursor:pointer; }
    .pill.active { background:#111; color:#fff; border-color:#111; }

    /* Table */
    .tableWrap { overflow-x:auto; border:1px solid #111; border-radius:10px; }
    table { border-collapse: collapse; width: 980px; background:#fff; }
    th, td { border:1px solid #111; padding:6px; font-size:12px; }
    th { background:#fff; }
    th.item { width: 420px; background:#ffd600; }
    td.item { font-size:11px; }
    td.day { text-align:center; width: 70px; }

    .markBtn {
      width: 100%;
      height: 26px;
      padding: 0;
      border-radius: 7px;
      border: 1px solid #cfcfcf;
      background:#fff;
      font-weight: 900;
      cursor:pointer;
      font-size: 15px;
      line-height: 26px;
    }
    .markBtn:disabled {
      cursor: not-allowed;
      color: #b9b9b9;
      border-color:#dddddd;
      background:#fafafa;
    }
    .markBtn.activeDay {
      border-color:#999;
      background:#fff;
      color:#111;
    }

    /* Mobile list (no horizontal scroll) */
    .mobileChecks { display:none; }
    .mobileRow {
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px;
      border:1px solid #111;
      border-radius:12px;
      margin-bottom:8px;
    }
    .mobileLabel {
      flex:1;
      font-size:12px;
      line-height:1.25;
    }
    .mobileBtn{
      width:72px;
      height:44px;
      border-radius:12px;
      border:1px solid #cfcfcf;
      background:#fff;
      font-weight:900;
      font-size:18px;
      cursor:pointer;
    }

    @media (max-width: 760px){
      .tableWrap { display:none; }
      .mobileChecks { display:block; }
    }

    /* Signature */
    canvas { width: 100%; height: 170px; border: 1px solid #ccc; border-radius: 12px; touch-action: none; }
    .btnRow { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }

    .submitBtn { border:0; background:#111; color:#fff; font-weight:900; padding: 12px; border-radius: 12px; cursor:pointer; }
  </style>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
  <div class="buildTag" id="buildTag">BUILD: v9</div>

  <div class="card">
    <div class="sheetHeader">
      <img class="logoLeft" src="assets/atl-logo.png" alt="Active Tunnelling">
      <div class="ref" id="formRef">QPFPL5.2</div>
      <img class="logoRight" src="assets/tp.png" alt="TP">
    </div>

    <div class="sheetTitle" id="sheetTitle">Excavator Pre-Use Inspection Checklist</div>

    <div class="metaRow">
      <div><b>Machine No:</b> <span id="machineNoPreview">—</span></div>
      <div style="text-align:right;"><b>Week commencing:</b> <span id="weekCommencingPreview">—</span></div>
    </div>

    <div class="yellowBar">
      All checks must be carried out in line with Specific Manufacturer’s instructions
    </div>

    <div class="topBtns" style="margin-top:12px;">
      <button class="pill active" id="btnExc" type="button">Excavator</button>
      <button class="pill" id="btnCrane" type="button">Crane</button>
      <button class="pill" id="btnDump" type="button">Dumper</button>
    </div>

    <p class="small" id="selectedType" style="margin:10px 0 0;">Selected: Excavator</p>
  </div>

  <div class="card">
    <div class="grid2">
      <div>
        <label>Site</label>
        <input id="site" placeholder="e.g. Hinckley" />
      </div>
      <div>
        <label>Date</label>
        <input id="date" type="date" />
      </div>
    </div>

    <div class="grid2" style="margin-top:10px;">
      <div>
        <label>Machine / Plant ID</label>
        <input id="plantId" placeholder="e.g. EXC-12 / AB12CDE" />
      </div>
      <div>
        <label>Operator name</label>
        <input id="operator" placeholder="Name" />
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Hours / Shift</label>
      <input id="hours" placeholder="e.g. 06:00–18:00" />
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Checks (Mon–Sun)</h3>
    <p class="small">Phone view uses a simple list (no sideways scrolling). Desktop shows the full weekly grid.</p>

    <!-- Mobile-friendly list -->
    <div id="mobileChecks" class="mobileChecks"></div>

    <!-- Desktop table -->
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th class="item"> </th>
            <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
          </tr>
        </thead>
        <tbody id="checksBody"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div>
      <label>Defects identified:</label>
      <textarea id="defectsText" placeholder="Write defects (if any)"></textarea>
    </div>
    <div style="margin-top:10px;">
      <label>Reported to / action taken:</label>
      <textarea id="actionTaken" placeholder="Who was informed and what was done"></textarea>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Signature</h3>
    <canvas id="sig"></canvas>
    <div class="btnRow">
      <button class="pill" id="clearSig" type="button">Clear</button>
      <button class="pill" id="fillToday" type="button">Today</button>
    </div>
  </div>

  <div class="card">
    <button id="submitBtn" class="submitBtn" type="button">Submit (email PDF)</button>
    <p class="small" id="status">Ready.</p>
  </div>

  <script>
    // Show JS errors on the page (helps when testing on phone)
    window.addEventListener("error", (e) => {
      const s = document.getElementById("status");
      if (s) s.textContent = "❌ JS error: " + (e.message || "unknown");
    });
  </script>

  <script src="app.js"></script>
</body>
</html>

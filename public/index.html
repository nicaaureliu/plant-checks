<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plant Checks</title>

  <style>
    :root{
      --border:#111;
      --grey:#e7e7e7;
      --light:#f6f6f6;
      --yellow:#ffd600;
    }
    body { font-family: Arial, sans-serif; margin: 0; padding: 14px; background:#fff; color:#111; }
    .small { font-size: 12px; color: #666; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin-bottom: 12px; background:#fff; }
    #buildTag { font-size:12px; color:#666; margin-bottom:8px; }

    /* Header */
    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .logoLeft{ width:150px; height:auto; object-fit:contain; }
    .logoRight{ width:55px; height:auto; object-fit:contain; }
    .ref { font-size: 18px; font-weight:700; text-align:center; flex:1; }
    .sheetTitle { text-align:center; font-size: 16px; font-weight:700; margin: 8px 0 0; }

    .metaRow {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
      font-size: 12px;
    }
    .metaRow b { font-weight:700; }

    .yellowBar {
      margin-top:10px;
      background:var(--yellow);
      padding:8px 10px;
      font-weight:700;
      font-size: 12px;
      text-align:center;
      border:1px solid var(--border);
      border-left:0;
      border-right:0;
    }

    /* Buttons */
    .topBtns { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:12px; }
    button { cursor:pointer; }
    .pill {
      background:#f3f3f3; border:1px solid #ddd; color:#111; font-weight:700;
      padding:10px; border-radius:12px;
    }
    .pill.active{ background:#111; color:#fff; border-color:#111; }

    /* Inputs */
    label { font-size: 12px; color: #444; display:block; margin-bottom:6px; }
    input, textarea { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; box-sizing: border-box; }
    textarea { min-height: 70px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }

    /* Desktop table */
    .tableWrap { overflow-x:auto; border:1px solid var(--border); border-radius:8px; }
    table { border-collapse: collapse; width: 980px; background:#fff; }
    th, td { border:1px solid var(--border); padding:6px; font-size:12px; }
    th { background:#fff; }
    th.item { width: 420px; background:var(--yellow); }
    td.item { font-size:11px; }

    .markBtn{
      width: 100%;
      height: 20px;
      border-radius: 7px;
      border: 1px solid #cfcfcf;
      background:#fff;
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#111;
      opacity:1;                /* IMPORTANT: keep visible on iPhone even when disabled */
    }
    .markBtn.disabled{
      background:#fafafa;
      color:#bdbdbd;            /* still visible */
      border-color:#dedede;
    }
    .markBtn.activeDay{
      border-color:#7f7f7f;
      box-shadow: inset 0 0 0 1px #7f7f7f;
    }

    /* Mobile checks list (better on phone) */
    .mobileOnly{ display:none; }
    .mobileChecks{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .mobileRow{
      border:1px solid #ddd;
      border-radius:10px;
      padding:10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .mobileLabel{ font-size:12px; color:#111; flex:1; }
    .mobileBtn{
      min-width:70px;
      height:34px;
      border-radius:10px;
      border:1px solid #cfcfcf;
      background:#fff;
      font-weight:900;
      font-size:16px;
    }

    /* Signature */
    canvas { width: 100%; height: 170px; border: 1px solid #ccc; border-radius: 10px; touch-action: none; }
    .btnRow { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }

    /* Submit */
    #submitBtn { border:0; background:#111; color:#fff; font-weight:800; padding: 12px; border-radius: 10px; width:100%; }
    #status { margin-top:8px; }

    /* Responsive switch */
    @media (max-width: 760px){
      .grid2 { grid-template-columns: 1fr; }
      .tableWrap{ display:none; }
      .mobileOnly{ display:block; }
      .logoLeft{ width:140px; }
      .logoRight{ width:52px; }
    }
  </style>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
  <div id="buildTag">BUILD: v10</div>

  <div class="card">
    <div class="sheetHeader">
      <img class="logoLeft" src="assets/atl-logo.png" alt="Active Tunnelling">
      <div class="ref" id="formRef">QPFPL5.2</div>
      <img class="logoRight" src="assets/tp.png" alt="TP">
    </div>

    <div class="sheetTitle" id="sheetTitle">Excavator Pre-Use Inspection Checklist</div>

    <div class="metaRow">
      <div><b>Machine No:</b> <span id="machineNoPreview">—</span></div>
      <div style="text-align:right;"><b>Week commencing:</b> <span id="weekCommencingPreview">—</span></div>
    </div>

    <div class="yellowBar">
      All checks must be carried out in line with Specific Manufacturer’s instructions
    </div>

    <div class="topBtns">
      <button class="pill" id="btnExc" type="button">Excavator</button>
      <button class="pill" id="btnCrane" type="button">Crane</button>
      <button class="pill" id="btnDump" type="button">Dumper</button>
    </div>

    <p class="small" id="selectedType" style="margin:10px 0 0;">Selected: —</p>
  </div>

  <div class="card">
    <div class="grid2">
      <div>
        <label>Site</label>
        <input id="site" placeholder="e.g. Hinckley" />
      </div>
      <div>
        <label>Date</label>
        <input id="date" type="date" />
      </div>
    </div>

    <div class="grid2" style="margin-top:10px;">
      <div>
        <label>Machine / Plant ID</label>
        <input id="plantId" placeholder="e.g. EXC-12 / AB12CDE" />
      </div>
      <div>
        <label>Operator name</label>
        <input id="operator" placeholder="Name" />
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Hours / Shift</label>
      <input id="hours" placeholder="e.g. 06:00–18:00" />
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Checks (Mon–Sun)</h3>
    <p class="small">
      Only the column for your selected date is editable. Click to cycle ✓ / X / N/A.
      <span class="mobileOnly"><br><b>Mobile:</b> use the list below (much easier).</span>
    </p>

    <!-- Desktop -->
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th class="item"></th>
            <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
          </tr>
        </thead>
        <tbody id="checksBody"></tbody>
      </table>
    </div>

    <!-- Mobile -->
    <div class="mobileOnly">
      <div id="mobileChecks" class="mobileChecks"></div>
    </div>
  </div>

  <div class="card">
    <div>
      <label>Defects identified:</label>
      <textarea id="defectsText" placeholder="Write defects (if any)"></textarea>
    </div>
    <div style="margin-top:10px;">
      <label>Reported to / action taken:</label>
      <textarea id="actionTaken" placeholder="Who was informed and what was done"></textarea>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Signature</h3>
    <canvas id="sig"></canvas>
    <div class="btnRow">
      <button class="pill" id="clearSig" type="button">Clear</button>
      <button class="pill" id="fillToday" type="button">Today</button>
    </div>
  </div>

  <div class="card">
    <button id="submitBtn" type="button">Submit (email PDF)</button>
    <p class="small" id="status">Ready.</p>
  </div>

  <script>
    // show JS errors on the page (helps a LOT on phones)
    window.addEventListener("error", (e) => {
      const s = document.getElementById("status");
      if (s) s.textContent = "❌ JS error: " + (e.message || "unknown");
    });
  </script>

  <script src="app.js"></script>
</body>
</html>

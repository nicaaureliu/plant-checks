<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plant Checks</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 14px; background:#fff; color:#111; }
    .small { font-size: 12px; color: #666; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin-bottom: 12px; background:#fff; }
    #buildTag { font-size:12px; color:#666; margin-bottom:8px; }

    .sheetHeader {
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:10px;
    }
    .logoLeft { width: 150px; height:auto; justify-self:start; }
    .logoRight { width: 55px; height:auto; justify-self:end; }
    .ref { font-size: 18px; justify-self:center; font-weight:800; }

    .sheetTitle { text-align:center; font-size: 16px; font-weight:700; margin: 8px 0 0; }
    .metaRow {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
      font-size: 12px;
    }
    .metaRow b { font-weight:700; }

    .yellowBar {
      margin-top:10px;
      background:#ffd600;
      padding:8px 10px;
      font-weight:700;
      font-size: 12px;
      text-align:center;
      border:1px solid #111;
      border-left:0;
      border-right:0;
    }

    label { font-size: 12px; color: #444; display:block; margin-bottom:6px; }
    input, textarea, button, select {
      width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; box-sizing: border-box;
      font-family: inherit;
    }
    textarea { min-height: 70px; }

    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .topBtns { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; align-items:center; }
    .pill { background:#f3f3f3; border:1px solid #ddd; color:#111; font-weight:700; cursor:pointer; }
    .pill.active { background:#111; color:#fff; border-color:#111; }

    .tableWrap { overflow-x:auto; border:1px solid #111; border-radius:8px; }
    table { border-collapse: collapse; width: 980px; background:#fff; }
    th, td { border:1px solid #111; padding:6px; font-size:12px; }
    th { background:#fff; }
    th.item { width: 420px; background:#ffd600; }
    td.item { font-size:11px; }
    td.day { text-align:center; width: 70px; }

    .markBtn {
      width: 100%;
      padding: 7px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      background:#fff;
      font-weight: 800;
      cursor:pointer;
    }
    .markBtn.disabled { opacity: .45; cursor: not-allowed; }

    .mobileWrap { display:none; }
    .mobileRow {
      display:flex;
      gap:10px;
      align-items:center;
      border:1px solid #eee;
      border-radius:10px;
      padding:10px;
      margin-bottom:8px;
    }
    .mobileLabel { flex: 1; font-size: 12px; }
    .mobileBtn {
      width: 80px;
      padding: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      background:#fff;
      font-weight: 900;
      cursor:pointer;
    }

    canvas { width: 100%; height: 170px; border: 1px solid #ccc; border-radius: 10px; touch-action: none; }
    .btnRow { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
    .submitBtn { border:0; background:#111; color:#fff; font-weight:800; padding: 12px; border-radius: 10px; cursor:pointer; }
    .submitBtn:disabled { opacity:.6; cursor:not-allowed; }

    @media (max-width: 760px) {
      .tableWrap { display:none; }
      .mobileWrap { display:block; }
      .logoLeft { width: 130px; }
      .logoRight { width: 48px; }
    }
  </style>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
  <div id="buildTag">BUILD: …</div>

  <div class="card">
    <div class="sheetHeader">
      <img class="logoLeft" src="assets/atl-logo.png" alt="Active Tunnelling">
      <div class="ref" id="formRef">QPFPL5.2</div>
      <img class="logoRight" src="assets/tp.png" alt="TP">
    </div>

    <div class="sheetTitle" id="sheetTitle">Excavator Pre-Use Inspection Checklist</div>

    <div class="metaRow">
      <div><b>Machine No:</b> <span id="machineNoPreview">—</span></div>
      <div style="text-align:right;"><b>Week commencing:</b> <span id="weekCommencingPreview">—</span></div>
    </div>

    <div class="yellowBar">
      All checks must be carried out in line with Specific Manufacturer’s instructions
    </div>

    <div class="topBtns" style="margin-top:12px;">
      <button class="pill" id="btnExc" type="button">Excavator</button>
      <button class="pill" id="btnCrane" type="button">Crane</button>
      <button class="pill" id="btnDump" type="button">Dumper</button>
    </div>

    <p class="small" id="selectedType" style="margin:10px 0 0;">Selected: —</p>
  </div>

  <div class="card">
    <div class="grid2">
      <div>
        <label>Site</label>
        <input id="site" placeholder="e.g. Hinckley" />
      </div>
      <div>
        <label>Date</label>
        <input id="date" type="date" />
      </div>
    </div>

    <div class="grid2" style="margin-top:10px;">
      <div>
        <label>Machine / Plant ID</label>
        <input id="plantId" placeholder="e.g. EXC-12 / AB12CDE" />
      </div>
      <div>
        <label>Operator name</label>
        <input id="operator" placeholder="Name" />
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Hours / Shift</label>
      <input id="hours" placeholder="e.g. 06:00–18:00" />
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Checks (Mon–Sun)</h3>
    <p class="small">Only the column for your selected date is editable. Tap the box to cycle ✓ / X / N/A.</p>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th class="item"> </th>
            <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
          </tr>
        </thead>
        <tbody id="checksBody"></tbody>
      </table>
    </div>

    <div id="mobileChecks" class="mobileWrap"></div>
  </div>

  <div class="card">
    <div>
      <label>Defects identified:</label>
      <textarea id="defectsText" placeholder="Write defects (if any)"></textarea>
    </div>

    <div style="margin-top:10px;">
      <label>Reported to (select):</label>
      <select id="reportedTo"></select>
    </div>

    <div style="margin-top:10px;">
      <label>Action taken:</label>
      <textarea id="actionTaken" placeholder="What was done / who was informed / reference"></textarea>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Signature</h3>
    <canvas id="sig"></canvas>
    <div class="btnRow">
      <button class="pill" id="clearSig" type="button">Clear</button>
      <button class="pill" id="fillToday" type="button">Today</button>
    </div>
  </div>

  <div class="card">
    <button id="submitBtn" class="submitBtn" type="button">Submit (email PDF)</button>
    <p class="small" id="status">Ready.</p>
  </div>

  <!-- show JS errors in the status line -->
  <script>
    window.addEventListener("error", (e) => {
      const s = document.getElementById("status");
      if (s) s.textContent = "❌ JS error: " + (e.message || "unknown");
    });
  </script>

  <!-- load app.js with visible status -->
  <script src="app.js"
    onload="document.getElementById('status').textContent='✅ app.js loaded';"
    onerror="document.getElementById('status').textContent='❌ app.js FAILED to load (check file path)';">
  </script>
</body>
</html>
